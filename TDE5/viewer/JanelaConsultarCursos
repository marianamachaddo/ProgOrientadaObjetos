package viewer;

import java.util.ArrayList;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.border.EmptyBorder;
import controller.curso.CtrlManterCursos;
import model.Curso;

public class JanelaConsultarCursos extends JanelaAbstrata<CtrlManterCursos> {
    private JPanel contentPane;
    private JTable tabela;
    private ArrayList<Curso> conjCursos;
    private JScrollPane scrollPane;

    public JanelaConsultarCursos(CtrlManterCursos ctrl, ArrayList<Curso> lista) {
        super(ctrl);
        setTitle("Manter Cursos");
        setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
        setBounds(100, 100, 550, 320);
        contentPane = new JPanel();
        contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
        setContentPane(contentPane);
        contentPane.setLayout(null);

        JButton btSair = new JButton("Sair");
        btSair.addActionListener(e -> getCtrl().encerrar());
        btSair.setBounds(435, 247, 89, 23);
        contentPane.add(btSair);

        scrollPane = new JScrollPane();
        scrollPane.setBounds(10, 11, 514, 220);
        contentPane.add(scrollPane);

        atualizarDados(lista);

        JButton btIncluir = new JButton("Incluir");
        btIncluir.addActionListener(e -> getCtrl().iniciarIncluirCurso());
        btIncluir.setBounds(10, 247, 89, 23);
        contentPane.add(btIncluir);

        JButton btAlterar = new JButton("Alterar");
        btAlterar.addActionListener(e -> {
            Curso curso = obterLinhaSelecionada();
            getCtrl().iniciarAlterarCurso(curso);
        });
        btAlterar.setBounds(121, 247, 89, 23);
        contentPane.add(btAlterar);

        JButton btExcluir = new JButton("Excluir");
        btExcluir.addActionListener(e -> {
            Curso curso = obterLinhaSelecionada();
            getCtrl().iniciarExcluirCurso(curso);
        });
        btExcluir.setBounds(231, 247, 89, 23);
        contentPane.add(btExcluir);
    }

    public void atualizarDados(ArrayList<Curso> lista) {
        this.conjCursos = lista;
        Curso[] array = lista.toArray(new Curso[0]);
        HelperTableModel h = new HelperTableModel(array);
        
        this.tabela = new JTable(h.getTableModel());
        new MeuHeaderListener(this.tabela); 
        
        this.scrollPane.setViewportView(this.tabela);
        this.scrollPane.revalidate();
        this.scrollPane.repaint();
    }

    public Curso obterLinhaSelecionada() {
        int numLinha = this.tabela.getSelectedRow();
        if (numLinha != -1) {
            // CORREÇÃO: Pela ordem alfabética, o Código do Curso é a coluna 0.
            int codigo = Integer.parseInt(this.tabela.getValueAt(numLinha, 0).toString());
            
            for (Curso c : conjCursos) {
                if (c.getCodigo() == codigo) {
                    return c;
                }
            }
        }
        return null;
    }
}
